<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>インデックス</title>
</h:head>

<h:body>
    <p:messages id="messages" />

    <h:form prependId="false" enctype="multipart/form-data">

        <p:fileUpload mode="advanced" multiple="true" sizeLimit="102400"
            allowTypes="/(\.|\/)(gif|jpe?g|png|txt)$/" label="ファイルを選択"
            uploadLabel="アップロード" cancelLabel="キャンセル"
            invalidSizeMessage="上限は100 KBです"
            invalidFileMessage="gif | jpg | jpeg | png | txt のみです"
            virusScan="true" listener="#{index.handleFileUpload}" />

        <p:commandButton icon="pi pi-download " title="ファイルダウンロード"
            actionListener="#{index.downloadFile}" ajax="false"
            onclick="PrimeFaces.monitorDownload(start, stop);">
            <p:fileDownload value="#{index.downloadedFile}" />
        </p:commandButton>

        <p:dialog  header="ダウンロード中" modal="true" widgetVar="statusDialog" draggable="false"
            closable="false" resizable="false">
            <i class="pi pi-spinner pi-spin" style="font-size: 3rem"></i>
        </p:dialog>

    </h:form>

    <script>
        function start() {
            PF('statusDialog').show();
        }

        function stop() {
            PF('statusDialog').hide();
        }
    </script>

</h:body>

</html>
