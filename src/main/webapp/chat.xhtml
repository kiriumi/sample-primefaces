<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>チャット</title>
</h:head>

<h:body>

    <f:metadata>
        <f:viewAction action="#{chat.init()}" />
    </f:metadata>

    <h:form prependId="false">

        <ui:repeat var="chatter" value="#{chat.chatters}">
            <p:panel header="#{chatter.name}">
                <h:outputText value="#{chatter.message}" />
            </p:panel>
        </ui:repeat>

        <p:inputTextarea value="#{chat.message}" />

        <p:commandButton ajax="false" value="送信" actionListener="#{chat.send}" />

        <f:websocket channel="chatChannel" onmessage="socketListener" />

        <h:inputHidden id="recieve-name" value="#{chat.recieveName}" />
        <h:inputHidden id="recieve-message" value="#{chat.recieveMessage}" />
        <p:commandButton style="visibility: hidden" id="recieve" ajax="false" value="受信"
            actionListener="#{chat.recieve}" />

    </h:form>

    <script>
        function socketListener(message, channel, event) {
            $("#hoge").text("ほげ");
            $("#recieve-name").val(message.name);
            $("#recieve-message").val(message.message);
            $("#recieve").click();
        }
    </script>

</h:body>

</html>
